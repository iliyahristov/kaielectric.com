{{ header }}
<div id="account-account" class="container">
    <ul class="breadcrumb">
        {% for breadcrumb in breadcrumbs %}
            <li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
        {% endfor %}
    </ul>
    {% if success %}
        <div class="alert alert-success alert-dismissible"><i class="fa fa-check-circle"></i> {{ success }}</div>
    {% endif %}
    <div class="row">{{ column_left }}
        {% if column_left and column_right %}
            {% set class = 'col-sm-6' %}
        {% elseif column_left or column_right %}
            {% set class = 'col-sm-9' %}
        {% else %}
            {% set class = 'col-sm-12' %}
        {% endif %}
        <div id="content" class="{{ class }}">{{ content_top }}

            <h1>{{ text_gdpr }}</h1>

            <h2>{{ text_request_personal_data }}</h2>
            <p>{{ text_request_personal_data_description }}</p>
            <ul class="list-unstyled">
                <li>
                    {% if customer_logged %}
                        <a class="btn btn-default" href="{{ request_personal_data_action }}">{{ button_request_personal_data }}</a>
                        <a class="btn btn-default" href="{{ request_request_data_action }}">{{ button_request_requests }}</a>
                        <a class="btn btn-default" href="{{ request_address_data_action }}">{{ button_request_addresses }}</a>
                        <a class="btn btn-default" href="{{ request_orders_data_action }}">{{ button_request_orders }}</a>
                    {% endif %}
                    <button class="btn btn-default" id="request_data">{{ button_request_data }}</button>
                </li>
            </ul>
            {% if customer_logged %}
                <h2>{{text_restricted_processing}}</h2>
                <p>{{ text_restricted_processing_description }}</p>
                <form class="form-horizontal" id="form-restrict">
                    <div class="form-group">
                        <div class="col-sm-12">
                            <input type="checkbox" name="restrict_processing" id="input-status" class="form-control" {{ restrict_processing? 'checked="checked"' }} />
                        </div>
                    </div>
                </form>
            {% endif %}

            <h2>{{ text_remove_personal_data }}</h2>
            <p>{{ text_remove_personal_data_description }}</p>
            <ul class="list-unstyled">
                <li>
                    <button class="btn btn-default" id="remove_data">{{ button_remove_data }}</button>
                </li>
            </ul>

            {{ content_bottom }}</div>
        {{ column_right }}</div>
</div>

<script type="text/javascript">

    $(document).ready(function(){
        $("[name=restrict_processing]").bootstrapSwitch({
            'onColor': 'success',
            'onText': '{{text_yes}}',
            'offText': '{{text_no}}'
        });

        $('[name=restrict_processing]').on('switchChange.bootstrapSwitch', function(event, state) {
            alertify.confirm(
                '{{ text_restricted_processing }}',
                '{{ text_restricted_processing_description }}',
                function (evt, value) {

                    $.ajax({
                        type: 'post',
                        url: '{{ restrict_data_action }}',
                        dataType: 'json',
                        data: {restrict_processing: state?1:0},
                        success: function (json) {
                            alert_handler(json);
                        },
                        error: function (xhr, ajaxOptions, thrownError) {
                            console.log(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                        }
                    });

                },
                function () {
                    $('[name=restrict_processing]').bootstrapSwitch('state', !state, true);
                }
            )
        })
    })

    function alert_handler(json) {
        _.each(json, function (element, index) {
            if (_.isObject(element)) {
                _.each(element, function (inner_element) {
                    alertify.notify(inner_element, index);
                });
            } else {
                alertify.notify(element, index);
            }
        });
    }

    $('body').on('click', '#request_data', function () {

        alertify.prompt(
            '{{ text_request_personal_data }}',
            '{{ button_request_data_description }}',
            'E-mail',
            function (evt, value) {

                $.ajax({
                    type: 'post',
                    url: '{{ request_data_action }}',
                    data: {email: value},
                    dataType: 'json',
                    success: function (json) {
                        alert_handler(json);
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                    }
                });

            },
            function () {
            }
        );

    });

    $('body').on('click', '#remove_data', function () {

        alertify.prompt(
            '{{ text_remove_personal_data }}',
            '{{ button_remove_data_description }}',
            'E-mail',
            function (evt, value) {

                $.ajax({
                    type: 'post',
                    url: '{{ remove_data_action }}',
                    dataType: 'json',
                    data: {email: value},
                    success: function (json) {
                        alert_handler(json);
                    },
                    error: function (xhr, ajaxOptions, thrownError) {
                        console.log(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                    }
                });

            },
            function () {
            }
        );

    });

</script>


{{ footer }}