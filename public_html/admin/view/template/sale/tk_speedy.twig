{{ header }}{{ column_left }}
<div id="content">
	<div class="page-header">
		<div class="container-fluid">
			<div class="pull-right">
				<a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a>
			</div>
			<h1>{{ heading_title }}</h1>
			<ul class="breadcrumb">
				{% for breadcrumb in breadcrumbs %}
					<li><a href="{{ breadcrumb['href'] }}">{{ breadcrumb['text'] }}</a></li>
				{% endfor %}
			</ul>
		</div>
	</div>
	<div class="container-fluid">
		{% if (error_warning) %}
			<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
				<button type="button" class="close" data-dismiss="alert">&times;</button>
			</div>
		{% endif %}
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title"><i class="fa fa-pencil"></i> {{ heading_title }}</h3>
			</div>
			<div class="panel-body">
				<form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-speedy" class="form-horizontal">
					
					<input id="shipping_speedy_taking_date" type="hidden" name="taking_date" value="{{ taking_date }}"/>
					<input type="hidden" id="abroad" name="abroad" value="{{ abroad }}"/>
					
					{% if (quote is not empty) %}
						<div class="form-group">
							<label class="col-sm-4 control-label">{{ entry_shipping_method }}</label>
							<div class="col-sm-8">
								{% for shipping_method_key_id,shipping_method in quote['quote'] %}
									<div class="radio">
										<label>
											<input type="radio" id="{{ shipping_method['code'] }}" data-shipping_method_id="{{ shipping_method_key_id }}" name="shipping_method" value="{{ shipping_method['code'] }}" {% if (shipping_method_key_id == shipping_method_id or quote['quote']|length == 1) %} checked="checked"{% endif %} />
											{{ shipping_method['title'] }}&nbsp;{{ shipping_method['text'] }}
										</label>
									</div>
								{% endfor %}
							</div>
						</div>
					{% endif %}
					
					<div class="form-group">
						<b><label class="col-sm-4 control-label" for="shipping_speedy_note">{{ text_calculate }}</label></b>
						<div class="col-sm-8">
							{% if (quote is not empty) %}
								<a id="createBillOfLading" onclick="speedySubmit();" class="btn btn-primary">2 - {{ button_create }}
									товарителница</a>
							{% else %}
								<a onclick="$('#calculate').val('1'); $('#form-speedy :input').removeAttr('disabled'); $('#form-speedy').submit();" class="btn btn-primary">1
									- {{ button_calculate }}</a>
							{% endif %}
							<input type="hidden" id="calculate" name="calculate" value="0"/>
							<input type="hidden" id="recalculate" name="recalculate" value="0"/>
						</div>
					</div>
					
					<hr>
					
					<div class="form-group required">
						<label class="col-sm-4 control-label" for="custmer_name">Име на клиент</label>
						<div class="col-sm-8">
							<input class="form-control" type="text" id="custmer_name" name="custmer_name" value="{{ custmer_name }}"/>
							{% if (error_custmer_name) %}
								<span class="text-danger">{{ error_custmer_name }}</span>
							{% endif %}
						</div>
					</div>

					<div class="form-group">
						<label class="col-sm-4 control-label" for="custmer_contact">Име на фирма (не е задължително) </label>
						<div class="col-sm-8">
							<input class="form-control" type="text" id="custmer_contact" name="custmer_contact" value="{{ custmer_contact }}"/>
						</div>
					</div>

					<div class="form-group required">
						<label class="col-sm-4 control-label" for="custmer_telephone">Телефон на клиент</label>
						<div class="col-sm-8">
							<input class="form-control" type="text" id="custmer_telephone" name="custmer_telephone" value="{{ custmer_telephone }}"/>
							{% if (error_custmer_telephone) %}
								<span class="text-danger">{{ error_custmer_telephone }}</span>
							{% endif %}
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-4 control-label" for="custmer_email">Е-майл на клиент</label>
						<div class="col-sm-8">
							<input class="form-control" type="text" id="custmer_email" name="custmer_email" value="{{ custmer_email }}"/>
						</div>
					</div>
					
					<div class="form-group required">
						<label class="col-sm-4 control-label" for="shipping_speedy_contents">{{ entry_contents }}
							<div style="font-weight: normal">Брой символи: <strong id="count-contents"></strong></div>
						</label>
						<div class="col-sm-8">
							<input class="form-control" type="text" id="shipping_speedy_contents" name="contents" value="{{ contents }}"/>
							{% if (error_contents) %}
								<span class="text-danger">{{ error_contents }}</span>
							{% endif %}
						</div>
					</div>
					<script>
              $('#shipping_speedy_contents').keyup(countname);
              $('#shipping_speedy_contents').keydown(countname);

              function countname() {
                  var cs_1_speedy_contents = $(this).val().length;
                  $('#count-contents').text(cs_1_speedy_contents);

                  if (cs_1_speedy_contents > 100 || cs_1_speedy_contents == 0) {
                      $('#count-contents').css('color', 'red');
                  } else {
                      $('#count-contents').css('color', 'green');
                  }
              }

              $(document).ready(function () {
                  var cs_2_speedy_contents = $('#shipping_speedy_contents').val().length;
                  $('#count-contents').text(cs_2_speedy_contents);

                  if (cs_2_speedy_contents > 100 || cs_2_speedy_contents == 0) {
                      $('#count-contents').css('color', 'red');
                  } else {
                      $('#count-contents').css('color', 'green');
                  }
              });
					
					</script>
					
					<div class="form-group required">
						<label class="col-sm-4 control-label" for="shipping_speedy_packing">{{ entry_packing }}</label>
						<div class="col-sm-8">
							<input class="form-control" type="text" id="shipping_speedy_packing" name="packing" value="{{ packing }}"/>
							{% if (error_packing) %}
								<span class="text-danger">{{ error_packing }}</span>
							{% endif %}
						</div>
					</div>
					
					<div class="form-group required">
						<label class="col-sm-4 control-label" for="client_id">{{ entry_client_id }}</label>
						<div class="col-sm-8">
							<select name="client_id" id="speedy_client_id" class="form-control">
								{% if clients|length > 1 or clients|length == 0 %}
									<option value="0">{{ text_none }}</option>
								{% endif %}
								{% for client in clients %}
									{% if client.clientId == client_id %}
										<option value="{{ client.clientId }}" selected="selected">{{ text_client_id|format(client.clientId, client.name, client.address) }}</option>
									{% else %}
										<option value="{{ client.clientId }}">{{ text_client_id|format(client.clientId, client.name, client.address) }}</option>
									{% endif %}
								{% endfor %}
							</select>
						</div>
					</div>
					
					<div class="form-group required">
						<label class="col-sm-4 control-label" for="shipping_speedy_weight">{{ entry_weight }}</label>
						<div class="col-sm-8">
							<input class="form-control" type="text" id="shipping_speedy_weight" name="weight" value="{{ weight }}"/>
							{% if (error_weight) %}
								<span class="text-danger">{{ error_weight }}</span>
							{% endif %}
						</div>
					</div>
					
					<div class="form-group required">
						<label class="col-sm-4 control-label" for="shipping_speedy_count">{{ entry_count }}</label>
						<div class="col-sm-8">
							<input class="form-control" type="text" id="shipping_speedy_count" name="count" value="{{ count }}"/>
							{% if (error_count) %}
								<span class="text-danger">{{ error_count }}</span>
							{% endif %}
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-4 control-label" for="shipping_speedy_width">{{ entry_size }}</label>
						<div class="table-responsive col-sm-8">
							<table id="parcels_size" class="table table-striped table-bordered table-hover">
								<thead>
								<tr>
									<td class="text-left">{{ entry_width }}</td>
									<td class="text-left">{{ entry_height }}</td>
									<td class="text-left">{{ entry_depth }}</td>
									<td class="text-left">{{ entry_parcel_weight }}</td>
								</tr>
								</thead>
								<tbody>
								{% set parcels_size_row = 1 %}
								{% for parcels_size in parcels_sizes %}
									<tr id="parcel-size-row{{ parcels_size_row }}">
										<td class="text-left">
											<input type="text" name="parcels_size[{{ parcels_size_row }}][width]" value="{{ parcels_size['width'] }}" placeholder="{{ entry_width }}" class="form-control"/>
										</td>
										<td class="text-left">
											<input type="text" name="parcels_size[{{ parcels_size_row }}][height]" value="{{ parcels_size['height'] }}" placeholder="{{ entry_height }}" class="form-control"/>
										</td>
										<td class="text-left">
											<input type="text" name="parcels_size[{{ parcels_size_row }}][depth]" value="{{ parcels_size['depth'] }}" placeholder="{{ entry_depth }}" class="form-control"/>
										</td>
										<td class="text-left">
											<input type="text" name="parcels_size[{{ parcels_size_row }}][weight]" value="{{ parcels_size['weight'] }}" placeholder="{{ entry_parcel_weight }}" class="form-control"/>
										</td>
									</tr>
									{% set parcels_size_row = parcels_size_row + 1 %}
								{% endfor %}
								</tbody>
							</table>
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-4 control-label" for="shipping_speedy_parcel_sizes">{{ entry_min_parcel_size }}</label>
						<div class="col-sm-8">
							<select name="parcel_size" id="shipping_speedy_parcel_sizes" class="form-control">
								{% for key,option in parcel_sizes %}
									{% if (key == parcel_size) %}
										<option value="{{ key }}" selected="selected">{{ option }}</option>
									{% else %}
										<option value="{{ key }}">{{ option }}</option>
									{% endif %}
								{% endfor %}
							</select>
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-4 control-label" for="shipping_speedy_client_note">{{ entry_client_note }}</label>
						<div class="col-sm-8">
							<textarea class="form-control" type="text" id="speedy_client_note" name="client_note" row="3">{{ client_note }}</textarea>
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-4 control-label" for="payer_type">{{ entry_payer_type }}</label>
						<div class="col-sm-8">
							<select name="payer_type" id="payer_type" class="form-control">
								{% for option_id, option in return_payer_types %}
									{% if option_id == payer_type %}
										<option value="{{ option_id }}" selected="selected">{{ option }}</option>
									{% else %}
										<option value="{{ option_id }}">{{ option }}</option>
									{% endif %}
								{% endfor %}
							</select>
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-4 control-label" for="shipping_speedy_deffered_days">Брой дни за отлагане</label>
						<div class="col-sm-8">
							<input class="form-control" type="number" id="shipping_speedy_deffered_days" name="deffered_days" value="{{ deffered_days }}"/>
						</div>
					</div>
					
					<div class="form-group" id="shipping_speedy_cod_container">
						<label class="col-sm-4 control-label">{{ entry_cod }}</label>
						<div class="col-sm-8">
							<label class="radio-inline" style="display: inline; width: auto; float: none;">
								<input type="radio" id="shipping_speedy_cod_yes" name="cod" value="1" {% if (cod) %} checked="checked"{% endif %} onclick="$('#shipping_speedy_total_container').show(); $('#shipping_speedy_option_before_payment_container').show(); "/>
								{{ text_yes }}
							</label> <label class="radio-inline" style="display: inline; width: auto; float: none;">
								<input type="radio" id="shipping_speedy_cod_no" name="cod" value="0" {% if (not cod) %} checked="checked"{% endif %} onclick="$('#shipping_speedy_total_container').hide(); $('#shipping_speedy_option_before_payment_container').hide(); "/>
								{{ text_no }}
							</label>
						</div>
					</div>
					
					<div class="form-group" id="shipping_speedy_total_container" {% if (not cod) %} style="display: none;"{% endif %} >
						<label class="col-sm-4 control-label" for="shipping_speedy_total">{{ entry_total }}</label>
						<div class="col-sm-8">
							<input class="form-control" type="text" id="shipping_speedy_total" name="total" value="{{ total }}"/>
						</div>
					</div>
					
					<div class="form-group" id="shipping_speedy_option_before_payment_container" {% if (not cod) %} style="display: none;" {% endif %}>
						<label class="col-sm-4 control-label" for="shipping_speedy_option_before_payment">{{ entry_options_before_payment }}</label>
						<div class="col-sm-8">
							<select name="option_before_payment" id="shipping_speedy_option_before_payment" class="form-control">
								{% for option_id,option in options_before_payment %}
									{% if (option_id == option_before_payment) %}
										<option value="{{ option_id }}" selected="selected">{{ option }}</option>
									{% else %}
										<option value="{{ option_id }}">{{ option }}</option>
									{% endif %}
								{% endfor %}
							</select>
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-4 control-label" for="return_payer_type">{{ entry_return_payer_type }}</label>
						<div class="col-sm-8">
							<select name="return_payer_type" id="return_payer_type" class="form-control">
								{% for option_id, option in return_payer_types %}
									{% if option_id == return_payer_type %}
										<option value="{{ option_id }}" selected="selected">{{ option }}</option>
									{% else %}
										<option value="{{ option_id }}">{{ option }}</option>
									{% endif %}
								{% endfor %}
							</select>
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-4 control-label" for="shipping_speedy_insurance">{{ entry_insurance }}</label>
						<div class="col-sm-8">
							<select class="form-control" id="shipping_speedy_insurance" name="insurance" onchange="$('#shipping_speedy_fragile').parent().parent().toggle(); $('#shipping_speedy_total_insurance').parent().parent().toggle();">
								{% if (insurance) %}
									<option value="1" selected="selected">{{ text_yes }}</option>
									<option value="0">{{ text_no }}</option>
								{% else %}
									<option value="1">{{ text_yes }}</option>
									<option value="0" selected="selected">{{ text_no }}</option>
								{% endif %}
							</select>
						</div>
					</div>
					
					<div class="form-group" {% if (not insurance) %} style="display: none;"{% endif %} >
						<label class="col-sm-4 control-label" for="shipping_speedy_fragile"><span data-toggle="tooltip" title="{{ help_fragile }}">{{ entry_fragile }}</span></label>
						<div class="col-sm-8">
							<select class="form-control" id="shipping_speedy_fragile" name="fragile">
								{% if (fragile) %}
									<option value="1" selected="selected">{{ text_yes }}</option>
									<option value="0">{{ text_no }}</option>
								{% else %}
									<option value="1">{{ text_yes }}</option>
									<option value="0" selected="selected">{{ text_no }}</option>
								{% endif %}
							</select>
						</div>
					</div>
					
					<div class="form-group" {% if (not insurance) %} style="display: none;"{% endif %} >
						<label class="col-sm-4 control-label" for="shipping_speedy_total_insurance">{{ entry_total_insurance }}</label>
						<div class="col-sm-8">
							<input class="form-control" type="text" id="shipping_speedy_total_insurance" name="totalNoShipping" value="{{ totalNoShipping }}"/>
						</div>
					</div>

					<div class="form-group">
						<label class="col-sm-4 control-label" >Заявка за обратна пратка</label>
						<div class="col-sm-8">
							<select class="form-control" name="swap">
								{% if (swap) %}
									<option value="1" selected="selected">{{ text_yes }}</option>
									<option value="0">{{ text_no }}</option>
								{% else %}
									<option value="1">{{ text_yes }}</option>
									<option value="0" selected="selected">{{ text_no }}</option>
								{% endif %}
							</select>
						</div>
					</div>
					
					<hr>
					<input type="hidden" id="shipping_speedy_country_id" name="country_id" value="{{ country_id }}"/>
					
					<div class="form-group">
						<div class="required">
							<label class="col-sm-4 control-label" for="speedy_country">{{ entry_country }}</label>
							<div class="col-sm-5">
								<input type="search" autocomplete="off" id="shipping_speedy_country" name="country" value="{{ country }}" class="form-control"/>
							</div>
						</div>
					</div>
					
					<div class="form-group">
						<label class="col-sm-4 control-label" for="shipping_speedy_city">{{ entry_city }}</label>
						<div class="col-sm-6">
							<input class="form-control" type="text" id="shipping_speedy_city" name="city" value="{{ city }}"/>
						</div>
						<input type="hidden" id="shipping_speedy_city_id" name="city_id" value="{{ city_id }}"/>
						<input type="hidden" id="shipping_speedy_city_nomenclature" name="city_nomenclature" value="{{ city_nomenclature }}"/>
						<label class="col-sm-1 control-label" for="shipping_speedy_postcode">{{ entry_postcode }}</label>
						<div class="col-sm-1">
							<input class="form-control" type="text" id="shipping_speedy_postcode" name="postcode" value="{{ postcode }}" disabled="disabled"/>
						</div>
					</div>
					
					<div class="form-group" id="to_office" {% if (offices is empty) %}style="display:none;" {% endif %}>
						<label class="col-sm-4 control-label">{{ entry_shipping_to }}</label>
						<div class="col-sm-8">
							<label class="radio-inline" style="display: inline; width: auto; float: none;">
								<input type="radio" id="shipping_speedy_shipping_to_door" name="to_office" value="0" {% if (not to_office) %} checked="checked"{% endif %} onclick="$('#shipping_speedy_quarter_container,#shipping_speedy_street_container,#shipping_speedy_block_no_container,#shipping_speedy_note_container').show(); $('#shipping_speedy_office_container').hide();"/>
								{{ text_to_door }}
							</label> <label class="radio-inline" style="display: inline; width: auto; float: none;">
								<input type="radio" id="shipping_speedy_shipping_to_office" name="to_office" value="1" {% if (to_office) %} checked="checked"{% endif %} onclick="$('#shipping_speedy_quarter_container,#shipping_speedy_street_container,#shipping_speedy_block_no_container,#shipping_speedy_note_container').hide(); $('#shipping_speedy_office_container').show();"/>
								{{ text_to_office }}
							</label>
						</div>
					</div>
					
					<div class="form-group" id="shipping_speedy_quarter_container" {% if (to_office) %} style="display: none;"{% endif %} >
						<label class="col-sm-4 control-label" for="shipping_speedy_quarter">{{ entry_quarter }}</label>
						<div class="col-sm-8">
							<input class="form-control" type="text" id="shipping_speedy_quarter" name="quarter" value="{{ quarter }}"/>
							<input type="hidden" id="shipping_speedy_quarter_id" name="quarter_id" value="{{ quarter_id }}"/>
						</div>
					</div>
					
					<div class="form-group" id="shipping_speedy_street_container" {% if (to_office) %} style="display: none;"{% endif %} >
						
						<label class="col-sm-4 control-label" for="shipping_speedy_street">{{ entry_street }}</label>
						<div class="col-sm-6">
							<input class="form-control" type="text" id="shipping_speedy_street" name="street" value="{{ street }}"/>
							<input type="hidden" id="shipping_speedy_street_id" name="street_id" value="{{ street_id }}"/>
							{% if (error_address) %}
								<span class="text-danger">{{ error_address }}</span>
							{% endif %}
						</div>
						
						<label class="col-sm-1 control-label" for="shipping_speedy_street_no">{{ entry_street_no }}</label>
						<div class="col-sm-1">
							<input class="form-control" type="text" id="shipping_speedy_street_no" name="street_no" value="{{ street_no }}"/>
						</div>
						
						<div class="clearfix"></div>
						<hr>
						<div class="clearfix"></div>
						
						<label class="col-sm-4 control-label" for="speedy_block_no">Блок:</label>
						<div class="col-sm-2">
							<input class="form-control" type="text" autocomplete="off" id="shipping_speedy_block_no" name="block_no" value="{{ block_no }}">
							<ul class="dropdown-menu"></ul>
						</div>
						
						<label class="col-sm-1 control-label" for="speedy_entrance_no">Вход:</label>
						<div class="col-sm-1">
							<input class="form-control" type="text" autocomplete="off" id="shipping_speedy_entrance_no" name="entrance_no" value="{{ entrance_no }}">
						</div>
						
						<label class="col-sm-1 control-label" for="speedy_floor_no">Етаж:</label>
						<div class="col-sm-1">
							<input class="form-control" type="text" autocomplete="off" id="shipping_speedy_floor_no" name="floor_no" value="{{ floor_no }}">
						</div>
						
						<label class="col-sm-1 control-label" for="speedy_apartment_no">Апартамент:</label>
						<div class="col-sm-1">
							<input class="form-control" type="text" autocomplete="off" id="shipping_speedy_apartment_no" name="apartment_no" value="{{ apartment_no }}">
						</div>
						
						<div class="clearfix"></div>
					
					</div>
					
					<div class="form-group" id="shipping_speedy_note_container" {% if (to_office) %} style="display: none;"{% endif %} >
						<label class="col-sm-4 control-label" for="shipping_speedy_note">{{ entry_note }}</label>
						<div class="col-sm-8">
							<input class="form-control" type="text" id="shipping_speedy_note" name="note" value="{{ note }}"/>
						</div>
					</div>
					
					<div class="form-group" id="shipping_speedy_office_container" {% if (not to_office) %} style="display: none;"{% endif %} >
						<label class="col-sm-4 control-label" for="shipping_speedy_office_id">{{ entry_office }}</label>
						<div class="col-sm-8">
							<select class="form-control" id="shipping_speedy_office_id" name="office_id">
								<option value="0">{{ text_select_office }}</option>
								{% for office in offices %}
									{% if (office['id'] == office_id) %}
										<option value="{{ office['id'] }}" selected="selected">{{ office['label'] }}</option>
									{% else %}
										<option value="{{ office['id'] }}">{{ office['label'] }}</option>
									{% endif %}
								{% endfor %}
							</select>
							{% if (error_office) %}
								<br/>&nbsp;&nbsp;&nbsp;<span class="text-danger">{{ error_office }}</span>
							{% endif %}
						</div>
					</div>
				
				</form>
			</div>
		</div>
	</div>
</div>
<script type="text/javascript">
    $('#shipping_speedy_parcel_sizes, #client_id').on('change', function () {
        if ($('#recalculate').val() == 0) {
            alert("{{ error_recalculate }}");

            $('#createBillOfLading').attr('disabled', 'disabled');
            $('#recalculate').val('1');
        }
    });

    function speedySubmit() {
        $('#createBillOfLading').off('click');
        $('#createBillOfLading').attr('disabled', 'disabled');
        if ($('[name="shipping_method"][value^="speedy."]:checked').length) {
            var shipping_method_id = $('[name="shipping_method"][value^="speedy."]:checked').data('shipping_method_id');
        } else {
            var shipping_method_id = '{{ shipping_method_id }}';
        }
        var post_data = {
            'shipping_method_id': shipping_method_id,
            'abroad': $('#abroad').val()
        };
		    
        post_data.speedy_shipping_to_office = $('input[name=to_office]:checked').val();
        post_data.speedy_option_before_payment = $('#shipping_speedy_option_before_payment').val();
        post_data.speedy_city_id = $('#shipping_speedy_city_id').val();
        post_data.speedy_office_id = $('#shipping_speedy_office_id').val();

        $.ajax({
            url: 'index.php?route=sale/tk_speedy/generate&user_token={{ user_token }}',
            type: 'POST',
            data: post_data,
            dataType: 'json',
            success: function (data) {
                if (data.error) {
                    var confurm = 1;

                    if (data.taking_date) {
                        $('#shipping_speedy_taking_date').val(data.taking_date);
                    }

                    for (error in data.errors) {
                        if (!confirm(data.errors[error])) {
                            confurm = 0;
                        }
                    }

                    if (confurm) {
                        $('#form-speedy :input').removeAttr('disabled');
                        $('#form-speedy').submit();
                    }
                } else {
                    $('#form-speedy :input').removeAttr('disabled');
                    $('#form-speedy').submit();
                }
            },
            error: function (xhr, ajaxOptions, thrownError) {
                //alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
            }
        });
    }


    var shipping_speedy_count_previous;

    $('#shipping_speedy_count').keydown(function (e) {
        if (!e.key.match(/\d/)) {
            e.preventDefault()
        }
    }).on('focus', function () {
        shipping_speedy_count_previous = parseInt($(this).val());
    }).change(function () {
        if (parseInt(shipping_speedy_count_previous) < parseInt($(this).val())) {
            addParcelsSize(parseInt(shipping_speedy_count_previous) + 1, parseInt($(this).val()));
        } else {
            removeParcelsSize(parseInt($(this).val()), parseInt(shipping_speedy_count_previous));
        }

        shipping_speedy_count_previous = parseInt($(this).val());
    });

    function addParcelsSize(old_rows, new_rows) {
        for (i = old_rows; i <= new_rows; i++) {
            html = '<tr id="parcel-size-row' + i + '">';
            html += ' <td class="text-left"><input type="text" name="parcels_size[' + i + '][width]" value="" placeholder="{{ entry_width }}" class="form-control" /></td>';
            html += ' <td class="text-left"><input type="text" name="parcels_size[' + i + '][height]" value="" placeholder="{{ entry_height }}" class="form-control" /></td>';
            html += ' <td class="text-left"><input type="text" name="parcels_size[' + i + '][depth]" value="" placeholder="{{ entry_depth }}" class="form-control" /></td>';
            html += ' <td class="text-left"><input type="text" name="parcels_size[' + i + '][weight]" value="" placeholder="{{ entry_parcel_weight }}" class="form-control" /></td>';
            html += '</tr>';

            $('#parcels_size tbody').append(html);
        }
    }

    function removeParcelsSize(old_rows, new_rows) {
        for (i = new_rows; i > old_rows; i--) {
            $('#parcel-size-row' + i).remove();
        }
    }

    var shipping_speedy_city = '{{ city }}';
    var shipping_speedy_quarter = '{{ quarter }}';
    var shipping_speedy_street = '{{ street }}';
    var shipping_speedy_country = '{{ country }}';
    var shipping_speedy_state = '{{ state }}';

    $(document).ready(function () {
		    
        $('#shipping_speedy_city').autocomplete({
            'source': function (request, response) {
                if (request) {
                    $.ajax({
                        url: 'index.php?route=sale/tk_speedy/getCities&user_token={{ user_token }}',
                        dataType: 'json',
                        type: 'get',
                        data: {
                            term: function () {
                                return $('#shipping_speedy_city').val();
                            },
                            country_id: $('#shipping_speedy_country_id').val(),
                            abroad: $('#abroad').val()
                        },
                        success: function (json) {
                            if ($('#shipping_speedy_city').is(":focus")) {
                                response($.map(json, function (item) {
                                    return {
                                        label: item['label'],
                                        value: item['value'],
                                        id: item['id'],
                                        postcode: item['postcode'],
                                        nomenclature: item['nomenclature']
                                    }
                                }));
                            }
                        }
                    });
                }
            },
            'select': function (item) {
                if (item) {
                    shipping_speedy_city = item.value;
                    $('#shipping_speedy_city').val(item.value);
                    $('#shipping_speedy_postcode').val(item.postcode);
                    $('#shipping_speedy_city_id').val(item.id);
                    $('#shipping_speedy_city_nomenclature').val(item.nomenclature);
                    $('#shipping_speedy_quarter').val('');
                    $('#shipping_speedy_quarter_id').val('');
                    $('#shipping_speedy_street').val('');
                    $('#shipping_speedy_street_id').val('');
                    $('#shipping_speedy_street_no').val('');
                    $('#shipping_speedy_block_no').val('');
                    $('#shipping_speedy_entrance_no').val('');
                    $('#shipping_speedy_floor_no').val('');
                    $('#shipping_speedy_apartment_no').val('');
                    $('#shipping_speedy_note').val('');
                    $('#shipping_speedy_office_id').html('<option value="0">{{ text_wait }}</option>');

                    $.ajax({
                        url: 'index.php?route=sale/tk_speedy/getOffices&user_token={{ user_token }}',
                        dataType: 'json',
                        data: {
                            city_id: item.id,
                            abroad: $('#abroad').val(),
                            country_id: $('#shipping_speedy_country_id').val()
                        },
                        success: function (data) {
                            if (data.error) {
                                alert(data.error);
                            } else {
                                html = '';

                                if (data.length) {
                                    $('#to_office').show();
                                    html += '<option value="0">{{ text_select_office }}</option>';
                                    for (i = 0; i < data.length; i++) {
                                        html += '<option value="' + data[i]['id'] + '">' + data[i]['label'] + '</option>';
                                    }
                                } else {
                                    $('#to_office').hide();
                                    $('[name=to_office][value=0]').trigger('click');
                                }

                                $('#shipping_speedy_office_id').html(html);
                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {
                            //alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                        }
                    });
                }
            },
            'change': function (item) {
                if (!item && $('#shipping_speedy_country_nomenclature').val() == 'FULL') {
                    $('#shipping_speedy_city').val('');
                    $('#shipping_speedy_city_id').val('');
                    $('#shipping_speedy_city_nomenclature').val('');
                    $('#shipping_speedy_postcode').val('');
                    $('#shipping_speedy_office_id').html('<option value="0">{{ text_select_city }}</option>');
                }

                $('#shipping_speedy_quarter').val('');
                $('#shipping_speedy_quarter_id').val('');
                $('#shipping_speedy_street').val('');
                $('#shipping_speedy_street_id').val('');
                $('#shipping_speedy_street_no').val('');
                $('#shipping_speedy_block_no').val('');
                $('#shipping_speedy_entrance_no').val('');
                $('#shipping_speedy_floor_no').val('');
                $('#shipping_speedy_apartment_no').val('');
                $('#shipping_speedy_note').val('');
            }
        });

        $('#shipping_speedy_city').blur(function () {
            if ($(this).val() != shipping_speedy_city) {

                if (!$('#abroad').val() || ($('#abroad').val() && ($('#shipping_speedy_country_nomenclature').val() == 'FULL'))) {
                    $('#shipping_speedy_city').val('');
                }

                $('#shipping_speedy_city_id').val('');
                $('#shipping_speedy_city_nomenclature').val('');
                $('#shipping_speedy_postcode').val('');
                $('#shipping_speedy_office_id').html('<option value="0">{{ text_select_city }}</option>');
                $('#shipping_speedy_quarter').val('');
                $('#shipping_speedy_quarter_id').val('');
                $('#shipping_speedy_street').val('');
                $('#shipping_speedy_street_id').val('');
                $('#shipping_speedy_street_no').val('');
                $('#shipping_speedy_block_no').val('');
                $('#shipping_speedy_entrance_no').val('');
                $('#shipping_speedy_floor_no').val('');
                $('#shipping_speedy_apartment_no').val('');
                $('#shipping_speedy_note').val('');
            }
        });

        $('#shipping_speedy_quarter').autocomplete({
            'source': function (request, response) {
                if (request) {
                    $.ajax({
                        url: 'index.php?route=sale/tk_speedy/getQuarters&user_token={{ user_token }}',
                        dataType: 'json',
                        data: {
                            term: function () {
                                return $('#shipping_speedy_quarter').val();
                            },
                            city_id: function () {
                                return $('#shipping_speedy_city_id').val();
                            },
                            abroad: $('#abroad').val()
                        },
                        success: function (data) {
                            if (data.error) {
                                $('#shipping_speedy_quarter').val('');
                                $('#shipping_speedy_quarter_id').val('');
                                alert(data.error);
                            } else {
                                if ($('#shipping_speedy_city_nomenclature').val() == 'FULL') {
                                    if (data.length) {
                                        response($.map(data, function (item) {
                                            return {
                                                label: item['label'],
                                                value: item['value'],
                                                id: item['id'],
                                            }
                                        }));
                                    }
                                } else {
                                    response($.map(data, function (item) {
                                        return {
                                            label: item['label'],
                                            value: item['value'],
                                            id: item['id'],
                                        }
                                    }));
                                }
                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {
                            //alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                        }
                    });
                }
            },
            'select': function (item) {
                if (item) {
                    shipping_speedy_quarter = item.value;
                    $('#shipping_speedy_quarter').val(item.value);
                    $('#shipping_speedy_quarter_id').val(item.id);
                }
            },
            'change': function (item) {
                if (!item && $('#shipping_speedy_city_nomenclature').val() == 'FULL') {
                    $('#shipping_speedy_quarter').val('');
                    $('#shipping_speedy_quarter_id').val('');
                }
            }
        });

        $('#shipping_speedy_quarter').blur(function () {
            if (($(this).val() != shipping_speedy_quarter) && ($('#shipping_speedy_city_nomenclature').val() == 'FULL')) {
                $('#shipping_speedy_quarter').val('');
                $('#shipping_speedy_quarter_id').val('');
            }
        });

        $('#shipping_speedy_street').autocomplete({
            'source': function (request, response) {
                if (request) {
                    $.ajax({
                        url: 'index.php?route=sale/tk_speedy/getStreets&user_token={{ user_token }}',
                        dataType: 'json',
                        data: {
                            term: function () {
                                return $('#shipping_speedy_street').val();
                            },
                            city_id: function () {
                                return $('#shipping_speedy_city_id').val();
                            },
                            abroad: $('#abroad').val()
                        },
                        success: function (data) {
                            if (data.error) {
                                $('#shipping_speedy_street').val('');
                                $('#shipping_speedy_street_id').val('');
                                alert(data.error);
                            } else {
                                if ($('#shipping_speedy_city_nomenclature').val() == 'FULL') {
                                    if (data.length) {
                                        response($.map(data, function (item) {
                                            return {
                                                label: item['label'],
                                                value: item['value'],
                                                id: item['id']
                                            }
                                        }));
                                    }
                                } else {
                                    response($.map(data, function (item) {
                                        return {
                                            label: item['label'],
                                            value: item['value'],
                                            id: item['id']
                                        }
                                    }));
                                }
                            }
                        },
                        error: function (xhr, ajaxOptions, thrownError) {
                            //alert(thrownError + "\r\n" + xhr.statusText + "\r\n" + xhr.responseText);
                        }
                    });
                }
            },
            'select': function (item) {
                if (item) {
                    shipping_speedy_street = item.value;
                    $('#shipping_speedy_street').val(item.value);
                    $('#shipping_speedy_street_id').val(item.id);
                }
            },
            'change': function (item) {
                if (!item) {
                    if (!item && $('#shipping_speedy_city_nomenclature').val() == 'FULL') {
                        $('#shipping_speedy_street').val('');
                        $('#shipping_speedy_street_id').val('');
                    }
                }
            }
        });

        $('#shipping_speedy_street').blur(function () {
            if (($(this).val() != shipping_speedy_street) && ($('#shipping_speedy_city_nomenclature').val() == 'FULL')) {
                $('#shipping_speedy_street').val('');
                $('#shipping_speedy_street_id').val('');
            }
        });


        $('#shipping_speedy_country').autocomplete({
            'source': function (request, response) {
                if (request) {
                    $.ajax({
                        url: 'index.php?route=sale/tk_speedy/getCountries&user_token={{ user_token }}',
                        dataType: 'json',
                        type: 'get',
                        data: {
                            term: request,
                            abroad: $('#abroad').val()
                        },
                        success: function (json) {
                            if ($('#shipping_speedy_country').is(":focus")) {
                                response($.map(json, function (item) {
                                    return {
                                        label: item['name'],
                                        value: item['name'],
                                        id: item['id'],
                                        nomenclature: item['nomenclature'],
                                        required_state: item['required_state'],
                                        required_postcode: item['required_postcode'],
                                        active_currency_code: item['active_currency_code'],
                                        address_nomenclature: item['address_nomenclature'],
                                    }
                                }));
                            }
                        }
                    });
                }
            },
            'select': function (item) {
                if (item) {
                    $('#abroad_shipping_speedy_state, #abroad_shipping_speedy_postcode').removeClass('required');
                    shipping_speedy_country = item.value;
                    $('#shipping_speedy_country').val(item.value);
                    $('#shipping_speedy_country_id').val(item.id);
                    $('#shipping_speedy_country_nomenclature').val(item.nomenclature);
                    $('#required_state').val(item.required_state);
                    $('#required_postcode').val(item.required_postcode);
                    $('#shipping_speedy_active_currency_code').val(item.active_currency_code);

                    if (item.address_nomenclature) {
                        $('#country_has_address_nomenclature').show();
                        $('#country_has_no_address_nomenclature').hide();
                    } else {
                        $('#country_has_address_nomenclature').hide();
                        $('#country_has_no_address_nomenclature').show();
                    }

                    if (!item.active_currency_code) {
                        $('#shipping_speedy_cod_container').hide();
                        $('#shipping_speedy_total_container').hide();
                        $('#shipping_speedy_option_before_payment_container').hide();
                        $('#shipping_speedy_cod_no').click();
                        $('#shipping_speedy_cod_status').val(0);
                    } else {
                        $('#shipping_speedy_cod_container').show();
                        $('#shipping_speedy_total_container').show();
                        $('#shipping_speedy_option_before_payment_container').show();
                        $('#shipping_speedy_cod_container').show();
                        $('#shipping_speedy_cod_status').val(1);
                    }

                    if (item.required_state) {
                        $('#abroad_shipping_speedy_state').addClass('required');
                    } else {
                        $('#abroad_shipping_speedy_state').removeClass('required');
                    }

                    if (item.required_postcode) {
                        $('#abroad_shipping_speedy_postcode').addClass('required');
                    } else {
                        $('#abroad_shipping_speedy_postcode').removeClass('required');
                    }
                }
            },
            'change': function (item) {
                if (!item) {
                    $('#to_office').hide();
                    $('[name=to_office][value=0]').trigger('click');

                    $('#shipping_speedy_country').val('');
                    $('#shipping_speedy_country_id').val('');
                    $('#shipping_speedy_country_nomenclature').val('');
                    $('#shipping_speedy_state').val('');
                    $('#shipping_speedy_state_id').val('');
                    $('#shipping_speedy_city').val('');
                    $('#shipping_speedy_city_id').val('');
                    $('#shipping_speedy_city_nomenclature').val('');
                    $('#shipping_speedy_quarter').val('');
                    $('#shipping_speedy_quarter_id').val('');
                    $('#shipping_speedy_street').val('');
                    $('#shipping_speedy_street_id').val('');
                    $('#shipping_speedy_street_no').val('');
                    $('#shipping_speedy_block_no').val('');
                    $('#shipping_speedy_entrance_no').val('');
                    $('#shipping_speedy_floor_no').val('');
                    $('#shipping_speedy_apartment_no').val('');
                    $('#shipping_speedy_note').val('');
                    $('#shipping_speedy_postcode').val('');
                    $('#shipping_speedy_fixed_time_cb').val('');
                }
            }
        });

        $('#shipping_speedy_country').blur(function () {
            if ($(this).val() != shipping_speedy_country) {
                $('#to_office').hide();
                $('[name=to_office][value=0]').trigger('click');

                $(this).val('');
                $('#shipping_speedy_country_id').val('');
                $('#shipping_speedy_country_nomenclature').val('');
                $('#shipping_speedy_state').val('');
                $('#shipping_speedy_state_id').val('');
                $('#shipping_speedy_city').val('');
                $('#shipping_speedy_city_id').val('');
                $('#shipping_speedy_city_nomenclature').val('');
                $('#shipping_speedy_quarter').val('');
                $('#shipping_speedy_quarter_id').val('');
                $('#shipping_speedy_street').val('');
                $('#shipping_speedy_street_id').val('');
                $('#shipping_speedy_street_no').val('');
                $('#shipping_speedy_block_no').val('');
                $('#shipping_speedy_entrance_no').val('');
                $('#shipping_speedy_floor_no').val('');
                $('#shipping_speedy_apartment_no').val('');
                $('#shipping_speedy_note').val('');
                $('#shipping_speedy_postcode').val('');
                $('#shipping_speedy_fixed_time_cb').val('');
            }
        });

        $('#shipping_speedy_state').autocomplete({
            'source': function (request, response) {
                if (request) {
                    $.ajax({
                        url: 'index.php?route=sale/tk_speedy/getStates&user_token={{ user_token }}',
                        dataType: 'json',
                        type: 'get',
                        data: {
                            term: request,
                            country_id: $('#shipping_speedy_country_id').val()
                        },
                        success: function (json) {
                            if ($('#shipping_speedy_state').is(":focus")) {
                                response($.map(json, function (item) {
                                    return {
                                        label: item['name'],
                                        value: item['name'],
                                        id: item['id']
                                    }
                                }));
                            }
                        }
                    });
                }
            },
            'select': function (item) {
                if (item) {
                    shipping_speedy_state = item.value;
                    $('#shipping_speedy_state').val(item.value);
                    $('#shipping_speedy_state_id').val(item.id);
                }
            },
            'change': function (item) {
                if (!item) {
                    $('#shipping_speedy_state').val('');
                    $('#shipping_speedy_state_id').val('');
                }
            }
        });

        $('#shipping_speedy_state').blur(function () {
            if ($(this).val() != shipping_speedy_state) {
                $(this).val('');
                $('#shipping_speedy_state_id').val('');
            }
        });

    });
</script>
{{ footer }}