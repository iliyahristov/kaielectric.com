{{ header }}{{ column_left }}
{% set weight_value_row = 0 %}
{% set percent_value_row = 0 %}
<div id="content">
	<div class="page-header">
		<div class="container-fluid">
			<div class="pull-right">
				
				<button type="submit" form="form-boxnow" data-toggle="tooltip" title="{{ button_save }}" class="btn btn-primary"><i class="fa fa-save"></i></button>
		
				<a href="{{ cancel }}" data-toggle="tooltip" title="{{ button_cancel }}" class="btn btn-default"><i class="fa fa-reply"></i></a>
			</div>
			<h1>{{ heading_title }}</h1>
			<ul class="breadcrumb">
				{% for breadcrumb in breadcrumbs %}
				<li><a href="{{ breadcrumb.href }}">{{ breadcrumb.text }}</a></li>
				{% endfor %}
			</ul>
		</div>
	</div>
	<div class="container-fluid">
 
		{% if error_warning%}
		<div class="alert alert-danger"><i class="fa fa-exclamation-circle"></i> {{ error_warning }}
			<button type="button" class="close" data-dismiss="alert">&times;</button>
		</div>
		{% endif %}
 
		{% if success%}
		<div class="alert alert-success alert-dismissible"><i class="fa fa-check-circle"></i> {{ success }}
			<button type="button" class="close" data-dismiss="alert">&times;</button>
		</div>
		{% endif %}
 
 
		{% if module_tk_checkout_token %} 

		
		<div class="panel panel-default">
			<div class="panel-body">
				<div class="form-group">
					<div class="col-sm-3 text-right"><p><b>Крон за ъпдейт на пратки:</b></p></div>
					<div class="col-sm-9">
						<p>/opt/cpanel/ea-php74/root/usr/bin/php {{ root }}catalog/controller/tk_checkout/cron_boxnow_shipping.php {{ web_url }}> /dev/null 2>&1</p>
					</div>
				</div>
			</div>
		</div>
			
			
					
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_edit }}</h3>
			</div>
			<div class="panel-body">
				
				<form action="{{ action }}" method="post" enctype="multipart/form-data" id="form-boxnow" class="form-horizontal">
 
					<ul class="nav nav-tabs">
						<li class="active"><a href="#tab-general" data-toggle="tab">Основни</a></li>
						<li><a href="#tab-price" data-toggle="tab">Ценообразуване</a></li>
						<li><a href="#tab-price_weight" data-toggle="tab">Ценообрзвуане спрямо килограми</a></li>
						<li><a href="#tab-status" data-toggle="tab">Статуси</a></li>
						<li><a href="#tab-lang" data-toggle="tab">Текстове</a></li>
					</ul>
			 
					<div class="tab-content">
			 
						<div class="tab-pane active" id="tab-general">
						
						
							<div class="form-group">
								<label class="col-sm-3 control-label" for="input-api_url">{{ entry_api_url }}</label>
								<div class="col-sm-9">
									<input type="text" name="shipping_tk_boxnow_api_url" value="{{ shipping_tk_boxnow_api_url }}" placeholder="{{ entry_api_url }}" id="input-api_url" class="form-control" />
								</div>
							</div>	 
							
							<div class="form-group">
								<label class="col-sm-3 control-label" for="input-widget_url">Widget url</label>
								<div class="col-sm-9">
									<input type="text" name="shipping_tk_boxnow_widget_url" value="{{ shipping_tk_boxnow_widget_url }}" placeholder="Widget url" id="input-widget_url" class="form-control" />
								</div>
							</div>	    
		 
							<div class="form-group">
								<label class="col-sm-3 control-label" for="input-client_id">{{ entry_client_id }}</label>
								<div class="col-sm-9">
									<input type="text" name="shipping_tk_boxnow_client_id" value="{{ shipping_tk_boxnow_client_id }}" placeholder="{{ entry_client_id }}" id="input-client_id" class="form-control" />
								</div>
							</div>			 
		 
							<div class="form-group">
								<label class="col-sm-3 control-label" for="input-client_secret">{{ entry_client_secret }}</label>
								<div class="col-sm-9">
									<input type="text" name="shipping_tk_boxnow_client_secret" value="{{ shipping_tk_boxnow_client_secret }}" placeholder="{{ entry_client_secret }}" id="input-client_secret" class="form-control" />
								</div>
							</div>			 
		 
							<div class="form-group">
								<label class="col-sm-3 control-label">{{ entry_warehouse_number }}</label>
								<div class="col-sm-9">
									<input type="text" name="shipping_tk_boxnow_warehouse_number" value="{{ shipping_tk_boxnow_warehouse_number }}" placeholder="{{ entry_warehouse_number }}" class="form-control" />
								</div>
							</div>
		 
							<div class="form-group">
								<label class="col-sm-3 control-label" for="input-partner_id">{{ entry_partner_id }}</label>
								<div class="col-sm-9">
									<input type="text" name="shipping_tk_boxnow_partner_id" value="{{ shipping_tk_boxnow_partner_id }}"
									placeholder="{{ entry_partner_id }}" id="input-partner_id" class="form-control" />
								</div>
							</div>
							
							
							     
							<div class="form-group">
								<label class="col-sm-3 control-label" for="tk_boxnow_geo_zone_id">{{ entry_geo_zone }}</label>
								<div class="col-sm-9">
									<select class="form-control" id="tk_boxnow_geo_zone_id" name="shipping_tk_boxnow_geo_zone_id">
										<option value="0">{{ text_all_zones }}</option>
										{% for geo_zone in geo_zones %}
										{% if geo_zone.geo_zone_id == tk_boxnow_geo_zone_id %}
										<option value="{{ geo_zone.geo_zone_id }}" selected="selected">{{ geo_zone.name }}</option>
										{% else %} 
										<option value="{{ geo_zone.geo_zone_id }}">{{ geo_zone.name }}</option>
										{% endif %}
										{% endfor %}
									</select>
								</div>
							</div>
							
							<div class="form-group">
								<label class="col-sm-3 control-label" for="input-tax-class">Данъчен клас</label>
								<div class="col-sm-9">
									<select name="shipping_tk_boxnow_tax_class_id" id="input-tax-class" class="form-control">
										<option value="0">{{ text_none }}</option>
										{% for tax_class in tax_classes %}
											{% if tax_class.tax_class_id == shipping_tk_boxnow_tax_class_id %}
												<option value="{{ tax_class.tax_class_id }}" selected="selected">{{ tax_class.title }}</option>
											{% else %}
												<option value="{{ tax_class.tax_class_id }}">{{ tax_class.title }}</option>
											{% endif %}
										{% endfor %}
									</select>
								</div>
							</div>
 
							<div class="form-group">
								<label class="col-sm-3 control-label" for="tk_boxnow_sort_order">{{ entry_sort_order }}</label>
								<div class="col-sm-9">
									<input class="form-control" type="text" id="tk_boxnow_sort_order" name="shipping_tk_boxnow_sort_order" value="{{ shipping_tk_boxnow_sort_order }}" />
								</div>
							</div>
	
							<div class="form-group">
								<label class="col-sm-3 control-label" for="tk_boxnow_status">{{ entry_status }}</label>
								<div class="col-sm-9">
									<select name="shipping_tk_boxnow_status" id="tk_boxnow_status" class="form-control">
										{% if shipping_tk_boxnow_status %}
										<option value="1" selected="selected">{{ text_enabled }}</option>
										<option value="0">{{ text_disabled }}</option>
										{% else %} 
										<option value="1">{{ text_enabled }}</option>
										<option value="0" selected="selected">{{ text_disabled }}</option>
										{% endif %}
									</select>
								</div>
							</div>
						
						</div>

						<div class="tab-pane" id="tab-price">
						
							<div class="form-group">
								<label class="col-sm-3 control-label">Да се разреши ли Плащане при доствка</label>
								<div class="col-sm-9">
									<select name="shipping_tk_boxnow_cod" id="tk_boxnow_cod" class="form-control">
										{% if shipping_tk_boxnow_cod %}
										<option value="1" selected="selected">{{ text_enabled }}</option>
										<option value="0">{{ text_disabled }}</option>
										{% else %} 
										<option value="1">{{ text_enabled }}</option>
										<option value="0" selected="selected">{{ text_disabled }}</option>
										{% endif %}
									</select>
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-3 control-label" for="shipping_tk_boxnow_weight">Забрани за тегло над:</label>
								<div class="col-sm-9">
									<input class="form-control" type="text" id="shipping_tk_boxnow_weight" name="shipping_tk_boxnow_weight" value="{{ shipping_tk_boxnow_weight }}" />
								</div>
							</div>
							
							<div class="form-group">
								<label class="col-sm-3 control-label" for="tk_boxnow_weight_type">Мерна единица</label>
								<div class="col-sm-9">
									<select class="form-control" id="tk_boxnow_weight_type" name="shipping_tk_boxnow_weight_type">
										<option value="kilogram" {% if shipping_tk_boxnow_weight_type == 'kilogram' %}selected="selected"{% endif %}>Килограм</option>
										<option value="gram" {% if shipping_tk_boxnow_weight_type == 'gram' %}selected="selected"{% endif %}>Грам</option>
									</select>
								</div>
							</div>
						
							<div class="form-group">
								<label class="col-sm-3 control-label" for="tk_boxnow_default_weight">Въведете тегло ако няма такова в количката</label>
								<div class="col-sm-9">
									<input class="form-control" type="text" id="tk_boxnow_default_weight" name="shipping_tk_boxnow_default_weight" value="{{ shipping_tk_boxnow_default_weight }}" />
								</div>
							</div>
							
							<div class="form-group">
								<label class="col-sm-3 control-label" for="input-cost">{{ entry_cost }}</label>
								<div class="col-sm-9">
									<input type="text" name="shipping_tk_boxnow_cost" value="{{ shipping_tk_boxnow_cost }}" placeholder="{{ entry_cost }}" id="input-cost" class="form-control" />
								</div>
							</div>
		 

							<div class="form-group">
								<label class="col-sm-3 control-label" for="tk_boxnow_free_shipping">{{ entry_free_shipping }}</label>
								<div class="col-sm-9">
									<div class="row">
										<div class="col-sm-4">
											<input type="text" name="shipping_tk_boxnow_free_shipping" value="{{ shipping_tk_boxnow_free_shipping }}" id="tk_boxnow_free_shipping" class="form-control" />
										</div>
										<label class="col-sm-4 control-label" for="tk_boxnow_free_weight">Тегло - до</label>
										<div class="col-sm-4">
											<input type="text" name="shipping_tk_boxnow_free_weight" value="{{ shipping_tk_boxnow_free_weight }}" id="tk_boxnow_free_weight" class="form-control" />
										</div>
									</div>
								</div>
							</div>
							
							<div class="form-group">
								<label class="col-sm-3 control-label"><span data-toggle="tooltip" title="Избери списък със суми които да се пресмятат за сума която трябва да се достигне преди да се активира отстъпката.">Избери суми</span></label>
								<div class="col-sm-9">
									<div class="well well-sm" style="height: 180px; overflow: auto;" id="totals">
										{% for total in oc_totals %}
										<div class="checkbox col-sm-4"><label><input type="checkbox" name="shipping_tk_boxnow_totals[]" value="{{ total.code }}" {% if total.code in shipping_tk_boxnow_totals %}checked="checked"{% endif %} />{{ total.name }}</label></div>
										{% endfor %}
									</div>
								</div>
							</div>

							<div class="form-group">
								<label class="col-sm-3 control-label"><span data-toggle="tooltip" title="Избери категории за които да бъде активен метода за доставка.">Избери Категории</span></label>
								<div class="col-sm-9">
									<div class="scroll-wrapper">
										<div class="well scroll">
											<div class="scroll-inner">
												{% for category in oc_categories %}
													<div>
														<label><input type="checkbox" name="shipping_tk_boxnow_categories[]" value="{{ category.category_id }}" {% if category.category_id in shipping_tk_boxnow_categories %}checked="checked"{% endif %} /> {{ category.name }}
														</label></div>
												{% endfor %}
											</div>
										</div>
										<div class="scroll-footer">
											<a class="expand-switcher"><i class="fa fa-angle-double-down"></i></a>
											<a class="select-all">избери всички</a>
											<a class="select-none">премахни всички</a>
										</div>
									</div>
								</div>
							</div>
							
						
						</div>

						<div class="tab-pane" id="tab-price_weight">
						
							<table id="weight-value" class="table table-striped table-bordered table-hover">
								<thead>
									<tr>
										<td class="text-left required">Килограми - От</td>
										<td class="text-left required">Килограми - До (включително)</td>
										<td class="text-left required">Твърда цена</td>
										<td></td>
									</tr>
								</thead>
								<tbody>
 
									
									{% for weight_value in shipping_tk_boxnow_weight_value %}
									<tr id="weight-value-row{{ weight_value_row }}">
										<td class="text-right"><input type="text" name="shipping_tk_boxnow_weight_value[{{ weight_value_row }}][from]" value="{{ weight_value.from }}" class="form-control" /></td>
										<td class="text-right"><input type="text" name="shipping_tk_boxnow_weight_value[{{ weight_value_row }}][to]" value="{{ weight_value.to }}" class="form-control" /></td>
										<td class="text-right"><input type="text" name="shipping_tk_boxnow_weight_value[{{ weight_value_row }}][price]" value="{{ weight_value.price }}" class="form-control" /></td>
										<td class="text-right"><button type="button" onclick="$('#weight-value-row{{ weight_value_row }}').remove();" data-bs-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>
									</tr>
									{% set weight_value_row = weight_value_row + 1 %}
									{% endfor %}
								</tbody>
 
								<tfoot>
									<tr>
										<td colspan="4"></td>
										<td class="text-right"><button type="button" onclick="addWeightValue();" data-toggle="tooltip" title="{{ button_weight_value_add }}" class="btn btn-primary"><i class="fa fa-plus-circle"></i></button></td>
									</tr>
								</tfoot>
							</table>
						
						</div>
					
						<div class="tab-pane" id="tab-status">
						
							<div class="form-group">
								<label class="col-sm-3 control-label" for="tk_boxnow_order_status_id">Статус на поръчката след генериране на товарителница:</label>
								<div class="col-sm-9">
									<select name="shipping_tk_boxnow_order_status_id" id="tk_boxnow_order_status_id" class="form-control">
										<option value="0">Без смяна на статуса</option>
										{% for order_status in order_statuses %}
										{% if (order_status['order_status_id'] == shipping_tk_boxnow_order_status_id) %} 
										<option value="{{ order_status.order_status_id }}" selected="selected">{{ order_status.name }}</option>
										{% else %} 
										<option value="{{ order_status.order_status_id }}">{{ order_status.name }}</option>
										{% endif %}
										{% endfor %}
									</select>
								</div>
							</div>
							

							<div class="form-group">
								<label class="col-sm-3 control-label" for="input-tk_boxnow_order_status_id_mail">Да се пратили и-меил след генериране на товарителница:</label>
								<div class="col-sm-9">
									<select name="shipping_tk_boxnow_order_status_id_mail" id="input-tk_boxnow_order_status_id_mail" class="form-control">
										{% if  shipping_tk_boxnow_order_status_id_mail %} 
										<option value="0">{{ entry_no }}</option>
										<option value="1" selected="selected">{{ entry_yes }}</option>
										{% else %} 
										<option value="0" selected="selected">{{ entry_no }}</option>
										<option value="1">{{ entry_yes }}</option>
										{% endif %}
									</select>
								</div>
							</div>
							
							<div class="form-group">
								<label class="col-sm-3 control-label" for="input-tk_boxnow_order_status_id_mail_text">Текст към и-меила след генериране на товарителница<br> ({shipment_number} - заменя номера на товарителница в текста):</label>
								<div class="col-sm-9">
									<textarea name="shipping_tk_boxnow_order_status_id_mail_text" rows="3" placeholder="Въведи текст" id="input-tk_boxnow_order_status_id_mail_text" class="form-control">{{ shipping_tk_boxnow_order_status_id_mail_text }}</textarea>
								</div>
							</div>

							<div class="form-group">
								<div class="col-sm-3 text-right"></div>
								<div class="col-sm-9">
									<br><br><h4><b>Синхронизиране на статуси между Boxnow и Opencart и изпращане на и-мейл до клиента</b></h4>
								</div>
							</div>

							{% for key,text_status in text_statuses %}
							<div class="form-group">
								<label class="col-sm-3 control-label">{{ text_status }}</label>
							
								<div class="col-sm-9">
									<div class="row">
										<div class="col-sm-3">Избери статус за синхронизиране</div>
										<div class="col-sm-3">
											<select name="shipping_tk_boxnow_order_status[{{ key }}]" id="input-tk_boxnow_order_status" class="form-control">
												<option value="">Без смяна на статуса</option>
												{% for order_status in order_statuses %}
												{% if  shipping_tk_boxnow_order_status[key] == order_status.order_status_id %} 
												<option value="{{ order_status.order_status_id }}" selected="selected">{{ order_status.name }}</option>
												{% else %} 
												<option value="{{ order_status.order_status_id }}">{{ order_status.name }}</option>
												{% endif %}
												{% endfor %}
											</select>
										</div>
										<div class="col-sm-3">Да се изпратили и-мейл до клиента</div>
										<div class="col-sm-3">
											<select name="shipping_tk_boxnow_order_status_mail[{{ key }}]" id="input-tk_boxnow_order_status_mail" class="form-control">
												{% if  shipping_tk_boxnow_order_status_mail[key] %} 
												<option value="0">{{ entry_no }}</option>
												<option value="1" selected="selected">{{ entry_yes }}</option>
												{% else %} 
												<option value="0" selected="selected">{{ entry_no }}</option>
												<option value="1">{{ entry_yes }}</option>
												{% endif %}
											</select>
										</div>
										<div class="clearfix"></div>
										<br>
									
										<div class="col-sm-3">Допълнителен текст към и-меила</div>
										<div class="col-sm-9">
											<textarea name="shipping_tk_boxnow_order_status_mail_text[{{ key }}]" rows="3" placeholder="Въведи текст" id="input-tk_boxnow_order_status_mail_text" class="form-control">{{ shipping_tk_boxnow_order_status_mail_text[key] }}</textarea>
										</div>
									</div>
								</div>
							</div>
							{% endfor %}
					
						</div>
					
						<div class="tab-pane" id="tab-lang">
						
							<div class="form-group row">
								<label class="col-sm-3 control-label">Име</label>
								<div class="col-sm-9">
									{% for language in languages %}
									<div class="input-group" style="margin-bottom: 5px">
										<span class="input-group-addon"><img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" /></span>
										<input type="text" name="shipping_tk_boxnow_text[{{ language.language_id }}][title]" value="{{ shipping_tk_boxnow_text[language.language_id].title ? shipping_tk_boxnow_text[language.language_id].title : '' }}" class="form-control" />
									</div>
									{% endfor %}
								</div>
							</div>
							
							<div class="form-group row">
								<label class="col-sm-3 control-label">Допълнително заглавие</label>
								<div class="col-sm-9">
									{% for language in languages %}
									<div class="input-group" style="margin-bottom: 5px">
										<span class="input-group-addon"><img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" /></span>
										<input type="text" name="shipping_tk_boxnow_text[{{ language.language_id }}][text]" value="{{ shipping_tk_boxnow_text[language.language_id].text ? shipping_tk_boxnow_text[language.language_id].text : 'Поръчки до 16:00ч. за София се доставят в СЪЩИЯ ДЕН!' }}" class="form-control" />
									</div>
									{% endfor %}
								</div>
							</div>
							
							<div class="form-group row">
								<label class="col-sm-3 control-label">Описание за наложен платеж</label>
								<div class="col-sm-9">
									{% for language in languages %}
									<div class="input-group" style="margin-bottom: 5px">
										<span class="input-group-addon"><img src="language/{{ language.code }}/{{ language.code }}.png" title="{{ language.name }}" /></span>
										<textarea name="shipping_tk_boxnow_text[{{ language.language_id }}][cod]" cols="80" rows="10" class="form-control">{{ shipping_tk_boxnow_text[language.language_id].cod ? shipping_tk_boxnow_text[language.language_id].cod : '
										Наложен платеж с BOX NOW
										
										ВНИМАНИЕ! При доставка до автомат на BOX NOW няма опция "Наложен платеж" с плащане в брой. Плащането трябва да се направи с банкова карта през линк, който ще получите по имейл/смс след изпращане.' }}</textarea>
									</div>
									{% endfor %}
								</div>
							</div>
							
						</div>
							
					</div>
				
				</form>
			</div>
		</div>

		{% else %} 
		<div class="panel panel-default">
			<div class="panel-heading">
				<h3 class="panel-title"><i class="fa fa-pencil"></i> {{ text_edit }}</h3>
			</div>
			<div class="panel-body">
				<h3>Трябва да активирате модула TK Checkout за да позлвате Доставка с boxnow</h3>			
			</div>

		</div>
		{% endif %}
		
	</div>
</div>


<style type="text/css">
	.scroll-wrapper {
		position: relative;
	}
	.scroll {
		overflow: auto;
		height: 150px;
		min-height: 150px;
		margin: 0;
		transition: 0.5s all;
	}
	.scroll-footer {
		margin-top: 10px;
	}
	.scroll-footer a {
		border-radius: 3px;
		line-height: 28px;
		cursor: pointer;
		display: inline-block;
		padding: 0 10px;
		border: 1px solid #ddd;
		margin: 0 3px;
	}
	.scroll-footer .expand-switcher {
		width: 30px;
		height: 30px;
	}
</style>

<script type="text/javascript">

	$('.remove-all').on('click', function() {
		$('#products').html('');
	});

	$('.select-all').on('click', function() {
		$(this).parents('.scroll-wrapper').find('input').prop('checked', true);
	});

	$('.select-none').on('click', function() {
		$(this).parents('.scroll-wrapper').find('input').prop('checked', false);
	});

	$('.expand-switcher').on('click', function() {
		if ($(this).hasClass('expanded')) {
			$(this).removeClass('expanded').html('<i class="fa fa-angle-double-down"></i>').parents('.scroll-wrapper').find('.scroll').height(110);
		} else {
			$(this).addClass('expanded').html('<i class="fa fa-angle-double-up"></i>').parents('.scroll-wrapper').find('.scroll').height($(this).parents('.scroll-wrapper').find('.scroll-inner').height());
		}
	});

	var weight_value_row = {{ weight_value_row}};

	function addWeightValue() {
		html  = '<tr id="weight-value-row' + weight_value_row + '">';
		html += '  <td class="text-right"><input type="text" name="shipping_tk_boxnow_weight_value[' + weight_value_row + '][from]" value="" placeholder="0.00" class="form-control" /></td>';
		html += '  <td class="text-right"><input type="text" name="shipping_tk_boxnow_weight_value[' + weight_value_row + '][to]" value="" placeholder="0.00" class="form-control" /></td>';
		html += '  <td class="text-right"><input type="text" name="shipping_tk_boxnow_weight_value[' + weight_value_row + '][price]" value="" placeholder="0.00" class="form-control" /></td>';
		html += '  <td class="text-right"><button type="button" onclick="$(\'#weight-value-row' + weight_value_row + '\').remove();" data-bs-toggle="tooltip" title="{{ button_remove }}" class="btn btn-danger"><i class="fa fa-minus-circle"></i></button></td>';
		html += '</tr>';

		$('#weight-value tbody').append(html);

		weight_value_row++;
	}
	

	function deleteRow(button) {
		jQuery(button).closest('tr').remove();
	}
</script>
{{ footer }}